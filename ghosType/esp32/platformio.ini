[env:esp32s3]
platform          = espressif32@6.8.1
board             = esp32-s3-devkitc-1
framework         = arduino

; ───── T-Dongle-S3 전용 설정 ─────
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.flash_mode = qio
board_build.partitions = default_16MB.csv
board_build.arduino.memory_type = qio_qspi
board_build.mcu = esp32s3
board_build.variant = esp32s3

; ───── USB 설정 (T-Dongle-S3 최적화) ─────
build_flags =
    -D ARDUINO_USB_MODE=1
    -D ARDUINO_USB_CDC_ON_BOOT=1
    
    ; ─ T-Dongle-S3 하드웨어 정의 ─
    -D ARDUINO_ESP32S3_DEV=1
    -D CONFIG_TINYUSB_ENABLED=1
    -D BOARD_HAS_PSRAM=0
    
    ; ─ BLE / NimBLE 설정 ─
    -D CONFIG_BT_NIMBLE_ROLE_PERIPHERAL=1
    -D CONFIG_BT_NIMBLE_ROLE_CENTRAL_DISABLED=1
    -D CONFIG_BT_NIMBLE_ROLE_OBSERVER_DISABLED=1
    -D CONFIG_BT_NIMBLE_MAX_CONNECTIONS=3
    
    ; ─ 핀 정의 ─
    -D RGB_LED_PIN=40
    -D T_DONGLE_S3_BOARD=1
    
    ; ─ ESP-IDF 컴포넌트 활성화 ─
    -D CONFIG_ESP_SYSTEM_EVENT_TASK_STACK_SIZE=2304
    -D CONFIG_ESP_MAIN_TASK_STACK_SIZE=3584
    
    ; ─ 최적화 ─
    -O2
    -w

; ───── 모니터링 및 디버그 ─────
monitor_speed = 115200
monitor_filters = esp32_exception_decoder, time
build_type = debug
debug_tool = esp-builtin
debug_init_break = tbreak setup

; ───── 라이브러리 ─────
lib_deps = 
    h2zero/NimBLE-Arduino@^1.4.0
    
; ───── 컴파일러 옵션 ─────
build_unflags = -std=gnu++11
lib_ldf_mode = deep+

; ───── 업로드 설정 ─────
upload_speed = 921600
upload_port = COM*